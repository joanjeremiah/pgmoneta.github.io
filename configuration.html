---
layout: default
---

<div id="home">
    <h1>
        {% for header in site.headers %}
        <a class="header" href="{{ header.url }}">{{ header.name }}</a>
        {% endfor %}
    </h1>
    <p/>

    <h2>pgmoneta.conf</h2>

    <h3>[pgmoneta]</h3>

    Main configuration of pgmoneta.
    <p/>
    
    <table border="1">
      <thead>
        <th align="left">Property</th>
        <th align="left">Default</th>
        <th align="left">Unit</th>
        <th align="left">Required</th>
        <th align="left">Description</th>
      </thead>
      <tbody>
        <tr>
          <td>host</td>
          <td></td>
          <td>String</td>
          <td>Yes</td>
          <td>The bind address for pgmoneta</td>
        </tr>
        <tr>
          <td>unix_socket_dir</td>
          <td></td>
          <td>String</td>
          <td>Yes</td>
          <td>The Unix Domain Socket location</td>
        </tr>
        <tr>
          <td>base_dir</td>
          <td></td>
          <td>String</td>
          <td>Yes</td>
          <td>The base directory for pgmoneta</td>
        </tr>
        <tr>
          <td>metrics</td>
          <td>0</td>
          <td>Int</td>
          <td>No</td>
          <td>The metrics port (disable = 0)</td>
        </tr>
        <tr>
          <td>metrics_cache_max_age</td>
          <td>0</td>
          <td>String</td>
          <td>No</td>
          <td>The number of seconds to keep in cache a Prometheus (metrics) response. If set to zero, the caching
            will be disabled. Can be a string with a suffix, like 2m to indicate 2 minutes</td>
        </tr>
        <tr>
          <td>metrics_cache_max_size</td>
          <td>256k</td>
          <td>String</td>
          <td>No</td>
          <td>The maximum amount of data to keep in cache when serving Prometheus responses. Changes require restart.
            This parameter determines the size of memory allocated for the cache even if metrics_cache_max_age or
            metrics are disabled. Its value, however, is taken into account only if metrics_cache_max_age is set to
            a non-zero value. Supports suffixes: B (bytes), the default if omitted, K or KB (kilobytes), M or
            MB (megabytes), G or GB (gigabytes)</td>
        </tr>
        <tr>
          <td>management</td>
          <td>0</td>
          <td>Int</td>
          <td>No</td>
          <td>The remote management port (disable = 0)</td>
        </tr>
        <tr>
          <td>compression</td>
          <td>zstd</td>
          <td>String</td>
          <td>No</td>
          <td>The compression type (none, gzip, zstd, lz4, bzip2)</td>
        </tr>
        <tr>
          <td>compression_level</td>
          <td>3</td>
          <td>Int</td>
          <td>No</td>
          <td>The compression level</td>
        </tr>
        <tr>
          <td>retention</td>
          <td>7</td>
          <td>Int</td>
          <td>No</td>
          <td>The retention time in days</td>
        </tr>
        <tr>
          <td>encryption</td>
          <td>none</td>
          <td>String</td>
          <td>No</td>
          <td>The encryption mode for encrypt wal and data none (No encryption), aes, aes-256, aes-256-cbc (AES Cipher Block Chaining mode with 256 bit key length),
            aes-192, aes-192-cbc (AES CBC mode with 192 bit key length), aes-128, aes-128-cbc (AES CBC mode with 128 bit key length),
            aes-256-ctr (AES Counter mode with 256 bit key length), aes-192-ctr (AES CTR mode with 192 bit key length),
            aes-128-ctr (AES CTR mode with 128 bit key length)</td>
        </tr>
        <tr>
          <td>storage_engine</td>
          <td>local</td>
          <td>String</td>
          <td>No</td>
          <td>The storage engine type (local, ssh, s3, azure)</td>
        </tr>
        <tr>
          <td>ssh_hostname</td>
          <td></td>
          <td>String</td>
          <td>Yes (if ssh)</td>
          <td>Defines the hostname of the remote system for connection</td>
        </tr>
        <tr>
          <td>ssh_username</td>
          <td></td>
          <td>String</td>
          <td>Yes (if ssh)</td>
          <td>Defines the username of the remote system for connection</td>
        </tr>
        <tr>
          <td>ssh_base_dir</td>
          <td></td>
          <td>String</td>
          <td>Yes (if ssh)</td>
          <td>The base directory for the remote backup</td>
        </tr>
        <tr>
          <td>link</td>
          <td>on</td>
          <td>Bool</td>
          <td>No</td>
          <td>Use links to limit backup size</td>
        </tr>
        <tr>
          <td>log_type</td>
          <td>console</td>
          <td>String</td>
          <td>No</td>
          <td>The logging type (console, file, syslog)</td>
        </tr>
        <tr>
          <td>log_level</td>
          <td>info</td>
          <td>String</td>
          <td>No</td>
          <td>The logging level, any of the (case insensitive) strings FATAL, ERROR, WARN, INFO and DEBUG
            (that can be more specific as DEBUG1 thru DEBUG5). Debug level greater than 5 will be set to DEBUG5.
            Not recognized values will make the log_level be INFO</td>
        </tr>
        <tr>
          <td>log_path</td>
          <td>pgexporter.log</td>
          <td>String</td>
          <td>No</td>
          <td>The log file location. Can be a strftime(3) compatible string</td>
        </tr>
        <tr>
          <td>log_rotation_age</td>
          <td>0</td>
          <td>String</td>
          <td>No</td>
          <td>The age that will trigger a log file rotation. If expressed as a positive number, is managed as seconds.
            Supports suffixes: S (seconds, the default), M (minutes), H (hours), D (days), W (weeks). A value of 0 disables</td>
        </tr>
        <tr>
          <td>log_rotation_size</td>
          <td>0</td>
          <td>String</td>
          <td>No</td>
          <td>The size of the log file that will trigger a log rotation. Supports suffixes: B (bytes), the default if omitted,
            K or KB (kilobytes), M or MB (megabytes), G or GB (gigabytes). A value of 0 (with or without suffix) disables</td>
        </tr>
        <tr>
          <td>log_line_prefix</td>
          <td>%Y-%m-%d %H:%M:%S</td>
          <td>String</td>
          <td>No</td>
          <td>A strftime(3) compatible string to use as prefix for every log line. Must be quoted if contains spaces</td>
        </tr>
        <tr>
          <td>log_mode</td>
          <td>append</td>
          <td>String</td>
          <td>No</td>
          <td>Append to or create the log file (append, create)</td>
        </tr>
        <tr>
          <td>blocking_timeout</td>
          <td>30</td>
          <td>Int</td>
          <td>No</td>
          <td>The number of seconds the process will be blocking for a connection (disable = 0)</td>
        </tr>
        <tr>
          <td>tls</td>
          <td>off</td>
          <td>Bool</td>
          <td>No</td>
          <td>Enable Transport Layer Security (TLS)</td>
        </tr>
        <tr>
          <td>tls_cert_file</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>Certificate file for TLS. This file must be owned by either the user running pgmoneta or root</td>
        </tr>
        <tr>
          <td>tls_key_file</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>Private key file for TLS. This file must be owned by either the user running pgmoneta or root.
            Additionally permissions must be at least 0640 when owned by root or 0600 otherwise.</td>
        </tr>
        <tr>
          <td>tls_ca_file</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>Certificate Authority (CA) file for TLS. This file must be owned by either the user running pgmoneta or root</td>
        </tr>
        <tr>
          <td>libev</td>
          <td>auto</td>
          <td>String</td>
          <td>No</td>
          <td>Select the <a href="http://software.schmorp.de/pkg/libev.html">libev</a> backend to use. Valid options: auto, select, poll, epoll, iouring, devpoll and port</td>
        </tr>
        <tr>
          <td>buffer_size</td>
          <td>65535</td>
          <td>Int</td>
          <td>No</td>
          <td>The network buffer size (SO_RCVBUF and SO_SNDBUF)</td>
        </tr>
        <tr>
          <td>keep_alive</td>
          <td>on</td>
          <td>Bool</td>
          <td>No</td>
          <td>Have SO_KEEPALIVE on sockets</td>
        </tr>
        <tr>
          <td>nodelay</td>
          <td>on</td>
          <td>Bool</td>
          <td>No</td>
          <td>Have TCP_NODELAY on sockets</td>
        </tr>
        <tr>
          <td>non_blocking</td>
          <td>on</td>
          <td>Bool</td>
          <td>No</td>
          <td>Have O_NONBLOCK on sockets</td>
        </tr>
        <tr>
          <td>backlog</td>
          <td>16</td>
          <td>Int</td>
          <td>No</td>
          <td>The backlog for listen(). Minimum 16</td>
        </tr>
        <tr>
          <td>hugepage</td>
          <td>try</td>
          <td>String</td>
          <td>No</td>
          <td>Huge page support (off, try, on)</td>
        </tr>
        <tr>
          <td>pidfile</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>Path to the PID file</td>
        </tr>
      </tbody>
    </table>

    <p/>
      
    <h3>Server section</h3>

    Specifies the PostgreSQL instances.
    <p/>

    <table border="1">
      <thead>
        <th align="left">Property</th>
        <th align="left">Default</th>
        <th align="left">Unit</th>
        <th align="left">Required</th>
        <th align="left">Description</th>
      </thead>
      <tbody>
        <tr>
          <td>host</td>
          <td></td>
          <td>String</td>
          <td>Yes</td>
          <td>The address of the PostgreSQL instance</td>
        </tr>
        <tr>
          <td>port</td>
          <td></td>
          <td>Int</td>
          <td>Yes</td>
          <td>The port of the PostgreSQL instance</td>
        </tr>
        <tr>
          <td>user</td>
          <td></td>
          <td>String</td>
          <td>Yes</td>
          <td>The replication user name</td>
        </tr>
        <tr>
          <td>backup_slot</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The replication slot for the backup</td>
        </tr>
        <tr>
          <td>wal_slot</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The replication slot for WAL</td>
        </tr>
        <tr>
          <td>follow</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>Failover to this server if follow server fails</td>
        </tr>
        <tr>
          <td>ssh_ciphers</td>
          <td>aes-256-ctr, aes-192-ctr, aes-128-ctr</td>
          <td>String</td>
          <td>No</td>
          <td>The supported ciphers for communication.<br/>
            aes | aes-256 | aes-256-cbc: AES CBC (Cipher Block Chaining) mode with 256 bit key length<br/>
            aes-192 | aes-192-cbc: AES CBC mode with 192 bit key length<br/>
            aes-128 | aes-128-cbc: AES CBC mode with 128 bit key length<br/>
            aes-256-ctr: AES CTR (Counter) mode with 256 bit key length<br/>
            aes-192-ctr: AES CTR mode with 192 bit key length<br/>
            aes-128-ctr: AES CTR mode with 128 bit key length.
            Otherwise verbatim
          </td>
        </tr>
        <tr>
          <td>s3_aws_region</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The AWS region</td>
        </tr>
        <tr>
          <td>s3_access_key_id</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The IAM access key ID</td>
        </tr>
        <tr>
          <td>s3_secret_access_key</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The IAM secret access key</td>
        </tr>
        <tr>
          <td>s3_bucket</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The AWS S3 bucket name</td>
        </tr>
        <tr>
          <td>s3_base_dir</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The base directory for the S3 bucket</td>
        </tr>
        <tr>
          <td>azure_storage_account</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The Azure storage account name</td>
        </tr>
        <tr>
          <td>azure_container</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The Azure container name</td>
        </tr>
        <tr>
          <td>azure_shared_key</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The Azure storage account key</td>
        </tr>
        <tr>
          <td>azure_base_dir</td>
          <td></td>
          <td>String</td>
          <td>No</td>
          <td>The base directory for the Azure container</td>
        </tr>
        <tr>
          <td>retention</td>
          <td>7, - , - , -</td>
          <td>Array</td>
          <td>No</td>
          <td>The retention time in days, weeks, months, years</td>
        </tr>
        <tr>
          <td>synchronous</td>
          <td>off</td>
          <td>Bool</td>
          <td>No</td>
          <td>Use synchronous receive</td>
        </tr>
      </tbody>
    </table>

    <p/>
    The configuration is loaded from either the path specified by the -c flag or /etc/pgmoneta/pgmoneta.conf.

    <h3>Example</h3>

    <pre>
[pgmoneta]
host = *
metrics = 5001

base_dir = /home/pgmoneta

compression = zstd

retention = 7

log_type = file
log_level = info
log_path = /tmp/pgmoneta.log

unix_socket_dir = /tmp/
pgsql_dir = /usr/bin/

[primary]
host = localhost
port = 5432
user = repl
    </pre>

    <h2>pgmoneta_users.conf</h2>

    The pgmoneta_users configuration defines the users known to the system. This file is created and managed through
    the pgmoneta-admin tool.
    <p/>
    The configuration is loaded from either the path specified by the -u flag or /etc/pgmoneta/pgmoneta_users.conf.

    <h2>pgmoneta_admins.conf</h2>

    The pgmoneta_admins configuration defines the administrators known to the system. This file is created and managed through
    the pgmoneta-admin tool.
    <p/>
    The configuration is loaded from either the path specified by the -A flag or /etc/pgmoneta/pgmoneta_admins.conf.
    <p/>

    If pgmoneta has both Transport Layer Security (TLS) and "management" enabled then pgmoneta-cli can
    connect with TLS using the files ~/.pgmoneta/pgmoneta.key (must be 0600 permission),
    ~/.pgmoneta/pgmoneta.crt and ~/.pgmoneta/root.crt.

</div>
